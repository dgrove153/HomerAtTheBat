extends layout
block inlineScripts
	script.
		var teams = JSON.parse($.find('#chartData')[0].value);
		var changeTotal = function(checkbox) {
			var change = parseInt(checkbox.value);
			if(!checkbox.checked) {
				change *= -1;
			}
			var curTotal = parseInt($('#total').text().split(":")[1]);
			if($('.player[minor_leaguer="false"]').find('input:checked').length > 10) {
				checkbox.checked = false;
				alert("Max number of keepers is 10");
			} else {
				curTotal += change;
				$('#total').text("Keeper Salary Total: " + curTotal);
			}
		};

		var saveChanges = function() {
			var payload = { team: 'GOB', total : 0, keepers: [], nonkeepers: [] }
			payload.total = parseInt($('#total').text().split(":")[1]);

			var players = $('.player');
			for(var i = 0; i < players.length; i++) {
				var name = players.eq(i).find('td').eq(0).text();
				if(players.eq(i).find("input[type=checkbox]:checked").length != 0) {
					payload.keepers.push(name);
				} else {
					payload.nonkeepers.push(name);
				}
			}
			$.post("/services/keeper", payload, function(result) {
				if(result == "worked") {
					alert('Your preferences have been saved');
				}
			});
		};

		var teamNames = [];
		var keepers = { name: 'Keepers', data: [] };
		$(teams).each(function(index, obj) {
			teamNames.push(obj.team);
			keepers.data.push(obj.history[obj.history.length-1].keeper_total > 0 ? obj.history[obj.history.length-1].keeper_total : 0);
		});
		$(function () {
			$('#chartContainer').highcharts({
				chart: {
					type: 'column'
				},
				title: {
					text: '2014 Keeper Dollars'
				},
				xAxis: {
					categories: teamNames
				},
				yAxis: {
					max: 260,
					title: {
						text: 'Dollars Spent'
					}
				},
				legend: {
					backgroundColor: '#FFFFFF',
					reversed: true
				},
				plotOptions: {
					series: {
						stacking: 'normal'
					}
				},
				series: [keepers]
			});
		});
    

block content
	h1= team.fullName
	-var str = JSON.stringify(teamList);
	input(type='hidden', id="chartData", value=str)
	//div#chartContainer
	h3#total 
		='Keeper Salary Total: '
		=team.history[team.history.length-1].keeper_total
		
	h3#saveButton
		-if(user != null && user.team == team.team)
			input.saveChanges(type="button" value="Save Selections" onclick="saveChanges()")

	table
		thead
			th Name
			-var lastYear = parseInt(year) - 1;
			-var lastYearHeader = "Salary " + lastYear;
			-var thisYearHeader = "Salary " + year;
			th= lastYearHeader
			th= thisYearHeader
			th Select as Keeper
		tbody
		-each pl in players
			tr("minor_leaguer"= pl.history[0].minor_leaguer ? "true" : "false").player
				td= pl.name_display_first_last
				-var salaryLastYear = '';
				-var salaryNextYear = '';
				-for(var i = 0; i < pl.history.length; i++) {
				-	if(pl.history[i].year == 2013) {
				-		salaryLastYear = pl.history[i].salary;
				-		if(pl.history[i].locked_up) {
				-			salaryNextYear = salaryLastYear;
				-		}
				-	}
				-}
				-for(var i = 0; i < pl.history.length; i++) {
				-	if(pl.history[i].year == 2014) {
				-		if(pl.history[i].locked_up || pl.history[i].minor_leaguer) {
				-			salaryNextYear = salaryLastYear;
				-		}
				-	}
				-}
				-if(salaryNextYear == '') {
				-	salaryNextYear = salaryLastYear + 3;
				-}
				td= salaryLastYear
				td= salaryNextYear
				td
					-var checked = pl.history[0].minor_leaguer || pl.history[0].locked_up || (pl.history[1] != null && pl.history[1].keeper_team != undefined && pl.history[1].keeper_team != '');
					-var disabled = pl.history[0].minor_leaguer || pl.history[0].locked_up || user == null || user.team != team.team;
					input.keeperBox(type="checkbox" value=salaryNextYear onclick="changeTotal(this)" checked=checked disabled=disabled)
				-if(pl.history[0].locked_up)
					td Locked Up
				-if(pl.history[0].minor_leaguer)
					td Minor Leaguer
	table
		thead
			th Assets
		tbody
		-each asset in assets
			tr
				td= asset.type
				td= asset.draft_round
	
